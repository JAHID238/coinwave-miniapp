<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CoinWave Pro Mini App</title>
<style>
  body { margin:0; font-family:system-ui,Arial; background:#f4f5f9; color:#111; }
  header { padding:16px; text-align:center; background:#0055aa; color:#fff; font-weight:600; font-size:18px; }
  .wrap { max-width:720px; margin:0 auto; padding:16px; }
  .card { background:#fff; border-radius:16px; padding:16px; box-shadow:0 6px 20px rgba(0,0,0,.08); margin:12px 0; }
  .btn { display:inline-block; padding:12px 16px; background:linear-gradient(90deg,#00c6ff,#0072ff); color:#fff; border-radius:10px; text-decoration:none; font-weight:600; transition:0.3s; }
  .btn:hover { opacity:0.85; }
  .muted { color:#777; font-size:14px; }
  .ad-box { display:flex; align-items:center; justify-content:center; border:1px dashed #ddd; border-radius:12px; margin:12px 0; min-height:90px; }
  .progress-container { background:#eee; border-radius:12px; overflow:hidden; margin-top:8px; height:12px; }
  .progress-bar { height:12px; width:0%; background:#00c6ff; transition:0.5s; }
  pre { background:#f0f0f0; padding:12px; border-radius:8px; overflow-x:auto; }
</style>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
<header>CoinWave Pro â€” Mini App</header>
<div class="wrap">

  <!-- Coins Balance -->
  <div class="card">
    <h2>Coins Balance</h2>
    <p style="font-size:24px; font-weight:600;" id="coin-balance">0 Coins</p>
    <div class="progress-container">
      <div class="progress-bar" id="coin-progress"></div>
    </div>
  </div>

  <!-- Tasks -->
  <div class="card">
    <h2>Daily Tasks</h2>
    <div class="task">
      <p>Watch Banner Ad</p>
      <a href="#" class="btn claim-btn" data-coins="5" data-ad="banner-300x250">Claim 5 Coins</a>
    </div>
    <div class="task" style="margin-top:8px;">
      <p>Watch Native Ad</p>
      <a href="#" class="btn claim-btn" data-coins="10" data-ad="native-banner">Claim 10 Coins</a>
    </div>
    <div class="task" style="margin-top:8px;">
      <p>Complete Survey</p>
      <a href="#" class="btn claim-btn" data-coins="15" data-ad="">Claim 15 Coins</a>
    </div>
  </div>

  <!-- Ads -->
  <div class="card">
    <h3>Banner Ad (300x250)</h3>
    <div id="banner-300x250" class="ad-box">Loading Banner...</div>

    <h3>Native Banner</h3>
    <div id="native-banner" class="ad-box">Loading Native Ad...</div>
  </div>

  <!-- User Info -->
  <div class="card">
    <h3>User Info</h3>
    <pre id="user">Loading user info...</pre>
  </div>

</div>

<script>
  // Telegram WebApp Integration
  const tg = window.Telegram?.WebApp;
  if(tg){
    tg.expand();
    tg.MainButton.setText("Close Mini App");
    tg.MainButton.onClick(()=>tg.close());
    tg.MainButton.show();
    const u = tg.initDataUnsafe?.user || {};
    document.getElementById('user').textContent = JSON.stringify({
      id: u.id, username: u.username, first_name: u.first_name, language_code: u.language_code
    }, null, 2);
  }

  // Coins system
  let coins = 0;
  const coinBalance = document.getElementById('coin-balance');
  const progressBar = document.getElementById('coin-progress');

  document.querySelectorAll('.claim-btn').forEach(btn=>{
    btn.addEventListener('click', e=>{
      e.preventDefault();
      let amount = parseInt(btn.dataset.coins);
      let adId = btn.dataset.ad;
      
      // Check if ad container exists & has content
      if(adId){
        const adBox = document.getElementById(adId);
        if(!adBox || adBox.innerHTML.includes("Loading")){
          alert("Please wait for the ad to load first!");
          return;
        }
      }

      coins += amount;
      coinBalance.textContent = coins + " Coins";
      let progress = Math.min((coins/100)*100,100);
      progressBar.style.width = progress+"%";
      alert(amount + " Coins added!");

      // Optional: send to backend
      // tg.sendData(JSON.stringify({ event:'claim', coins: amount }));
    });
  });

  // Adsterra Banner
  let bannerScript = document.createElement('script');
  bannerScript.type = "text/javascript";
  bannerScript.src = "//www.highperformanceformat.com/6928b0f5b1a27066c76882257e555423/invoke.js";
  document.getElementById('banner-300x250').appendChild(bannerScript);

  // Adsterra Native
  let nativeScript = document.createElement('script');
  nativeScript.type = "text/javascript";
  nativeScript.async = true;
  nativeScript.src = "//pl25115346.profitableratecpm.com/ca1b8379ef33060d43ac0c3db8e8035e/invoke.js";
  document.getElementById('native-banner').appendChild(nativeScript);
</script>
</body>
</html>
